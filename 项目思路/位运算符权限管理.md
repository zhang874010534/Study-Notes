### [基于位运算的权限控制](https://www.jianshu.com/p/262652908eb8)

Linux权限控制是基于位运算实现的。

在Linux权限系统中，`读`、`写`、`执行`权限分别对应三个状态位：

```dart
读   写   执行      二进制     十进制
0    0    1   ==>   001  ==>  1
0    1    0   ==>   010  ==>  2
1    0    0   ==>   100  ==>  4
0    1    1   ==>   011  ==>  3
1    0    1   ==>   101  ==>  5
1    1    0   ==>   110  ==>  6
1    1    1   ==>   111  ==>  7
```

如上所示，“执行”权限使用二进制为`001`，即：十进制`1`。“写入”权限使用二进制为`010`，即：十进制`2`。“读取”权限使用二进制为`100`，即：十进制`4`。

### `或运算`实现权限的添加

增加权限使用`或`（`|`）运算实现。

如，为用户增加“读取”、“写入”两种权限

```dart
读   写   执行      二进制     十进制
0    1    0   ==>   010  ==>  2
1    0    0   ==>   100  ==>  4
1    1    0   ==>   110  ==>  6  // 或（|）运算结果
```

“读写”两种权限，权限码为`6`（`110`），其由权限码`2`（`010`）和`4`（`100`）进行`或`（`|`）运算后实现，即：`6 = 2|4`，也可以由`6=2+4`计算得出。

### `与运算`实现权限的判断

在需要进行用户权限判断时，可以使用`与`（`&`）运算判断用户是否据有某项权限。

如，判断权限码为`6`用户是否有读取权限：

```dart
读   写   执行      二进制     十进制
1    1    0   ==>   110  ==>  6
1    0    0   ==>   100  ==>  4
1    0    0   ==>   100  ==>  4  // 与（&）运算结果
```

权限码`6`（`110`）和`4`（`100`）的与运算结果为`4`，即：`4=6&4`。

判断权限码为`6`用户是否有执行权限：

```dart
读   写   执行      二进制      十进制
1    1    0   ==>   110   ==>  6
0    0    1   ==>   001   ==>  1
0    0    0   ==>   000   ==>  0  // 与（&）运算结果
```

权限码`6`（`110`）和`1`（`001`）的与运算结果为`0`，即：`0=6&1`。

根据`与运算`的计算规律，当运算结果为所要判断权限本身值时，我们可以认为用户具有这个权限。而当运算结果为 0 时，我们可以认为用户不具有这个权限。

### `非运算`实现权限的减少

位运算同样可以实现用户权限的减少，减少用户权限使用`非`（`^`）运算。

如，将权限码为`7`用户，移除执行权限：

```dart
读   写   执行      二进制      十进制
1    1    1   ==>   111   ==>  7
0    0    1   ==>   001   ==>  1
1    1    0   ==>   110   ==>  6  // 非（^）运算结果
```

权限码`7`（`111`）和`1`（`001`）的非运算结果为`6`，即：`6=7^1`，也可以由`6=7-1`计算得出

### `位移`与权限码

从上面的介绍可以看出，在权限管理系统中每操作的`权限码`都是唯一的。而基于位运算的权限管理系统，要求每个`权限码`的二进制数形式，都只能有一位值为`1`。

所使用的`权限码`，可以将前一个`权限码``左位移`一位得到下一个权限码，即：

- 权限码`1`（`001`），即：20
- `2=1<<1`，即：将`001`左移1位为`010`，也即：由20变为21
- `4=2<<1`，即：将`010`左移1位为`100`，也即：由21变为22
- `8=4<<1`，即：将`100`左移1位为`1000`，也即：由22变为23

简单的说，`权限码`都是`2的幂数`，`2<sup>0</sup>、2<sup>1</sup>、2<sup>2</sup>、2<sup>3</sup>、……2<sup>n</sup>`依次对应权限码`1、2、4、8……n`。