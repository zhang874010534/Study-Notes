### CSRF 了解吗？如何进行一次 CSRF 攻击？ 

- CSRF（跨站请求伪造）：在未做 CSRF 防护的网站 A 中诱导用于点击第三方攻击网站 B，第三方攻击网站 B 中存在向网站 A 的服务器发送的请求，访问网站 B 就自动发送，请求会自动带上网站 A 的 cookie，能够冒用网站 A 的身份，这就形成了一次 CSRF 攻击。
- 预防：在 HTTP header 中加入 **origin 和 **[referer](https://www.cnblogs.com/Renyi-Fan/p/12570726.html) 来验证请求来源，拦截第三方的请求；用户访问时由服务端生成一个随机 **token**，保存在服务端 session 中，同时将 token 发送至客户端，客户端的每个请求都需要带上这个 token，与服务端 session 中保存的 token 比对，若 token 未过期且比对通过，才认证为一次合法的请求；**cookie SameSite 属性**；

  **CSRF攻击原理及过程如下：** [文章](https://blog.csdn.net/xiaoxinshuaiga/article/details/80766369)

1. 用户C打开浏览器，访问受信任网站A，输入用户名和密码请求登录网站A；
2. 在用户信息通过验证后，网站A产生Cookie信息并返回给浏览器，此时用户登录网站A成功，可以正常发送请求到网站A；
3. 用户未退出网站A之前，在同一浏览器中，打开一个TAB页访问网站B；

    4. 网站B接收到用户请求后，返回一些攻击性代码，并发出一个请求要求访问第三方站点A；

5. 浏览器在接收到这些攻击性代码后，根据网站B的请求，在用户不知情的情况下携带Cookie信息，向网站A发出请求。网站A并不知道该请求其实是由B发起的，所以会根据用户C的Cookie信息以C的权限处理该请求，导致来自网站B的恶意代码被执行。 

他先自己做一个网站，在网站中放入如下代码： src=”http://bank.example/withdraw?account=bob&amount=1000000&for=Mallory ”，并且通过广告等诱使 Bob 来访问他的网站。当 Bob 访问该网站时，上述 url 就会从 Bob 的浏览器发向银行，而这个请求会附带 Bob 浏览器中的 cookie 一起发向银行服务器。大多数情况下，该请求会失败，因为他要求 Bob 的认证信息。但是，如果 Bob 当时恰巧刚访问他的银行后不久，他的浏览器与银行网站之间的 session 尚未过期，浏览器的 cookie 之中含有 Bob 的认证信息。这时，悲剧发生了，这个 url 请求就会得到响应，钱将从 Bob 的账号转移到 Mallory 的账号，而 Bob 当时毫不知情。等以后 Bob 发现账户钱少了，即使他去银行查询日志，他也只能发现确实有一个来自于他本人的合法请求转移了资金，没有任何被攻击的痕迹。而 Mallory 则可以拿到钱后逍遥法外。 

**总结**：用户访问奇怪的网站，奇怪的网站里有一个请求被发送了出去并且带着用户的cookie 关键点就在于会带着用户的cookie，而现在HTTP header里有orgin或者referer来表示来源，所以就知道是不是用户自己发出来的请求了

cookie还有一个domain属性，说不定也可以限制一下，防止CSRF

### 防护

- CSRF: 跨站请求伪造，防护:
  - get 不修改数据
  - 不被第三方网站访问到用户的 cookie
  - 设置白名单，不被第三方网站请求
  - 请求校验
